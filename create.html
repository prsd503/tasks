<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Task Manager</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background: #ffffff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
      color: #333;
    }

    form {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    input[type="text"], input[type="date"] {
      padding: 10px;
      flex: 1;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1em;
    }

    button {
      padding: 10px 20px;
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #004c99;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #e0f0ff;
      margin-bottom: 10px;
      padding: 12px;
      border-radius: 8px;
      transition: background-color 0.3s;
      cursor: grab;
    }

    .task-text {
      flex-grow: 1;
      margin-right: 10px;
    }

    .actions button {
      margin-left: 5px;
      background-color: #ccc;
      color: #333;
    }

    .actions button:hover {
      background-color: #aaa;
    }

    .blue { background-color: #e0f0ff; }
    .orange { background-color: #ffe0b2; }
    .red { background-color: #ffcccc; }
    .green { background-color: #c8e6c9; }

    .download-btn {
      display: block;
      margin: 0 auto;
      background-color: #2e7d32;
      margin-top: 20px;
    }

    @media (max-width: 600px) {
      form {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Task Manager</h1>
    <form id="taskForm">
      <input type="text" id="taskName" placeholder="Enter task..." required>
      <input type="date" id="taskDate" required>
      <button type="submit">Add Task</button>
    </form>

    <ul id="taskList"></ul>

    <button class="download-btn" onclick="downloadCSV()">Download All Tasks</button>
  </div>

  <script>
    const taskForm = document.getElementById("taskForm");
    const taskList = document.getElementById("taskList");

    let tasks = [];

    taskForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("taskName").value;
      const date = document.getElementById("taskDate").value;
      tasks.push({ name, date, completed: false });
      document.getElementById("taskName").value = '';
      document.getElementById("taskDate").value = '';
      renderTasks();
    });

    function renderTasks() {
      taskList.innerHTML = '';
      tasks.forEach((task, index) => {
        const li = document.createElement("li");
        li.setAttribute("draggable", true);
        li.addEventListener("dragstart", e => e.dataTransfer.setData("text/plain", index));
        li.addEventListener("dragover", e => e.preventDefault());
        li.addEventListener("drop", e => {
          const from = e.dataTransfer.getData("text/plain");
          const to = index;
          const moved = tasks.splice(from, 1)[0];
          tasks.splice(to, 0, moved);
          renderTasks();
        });

        const daysLeft = (new Date(task.date) - new Date()) / (1000 * 3600 * 24);
        let statusClass = "blue";
        if (task.completed) statusClass = "green";
        else if (daysLeft < 0) statusClass = "red";
        else if (daysLeft <= 1) statusClass = "red";
        else if (daysLeft <= 7) statusClass = "orange";

        li.className = statusClass;

        const taskSpan = document.createElement("span");
        taskSpan.className = "task-text";
        taskSpan.textContent = `${task.name} (Due: ${task.date})`;

        const actions = document.createElement("div");
        actions.className = "actions";

        const completeBtn = document.createElement("button");
        completeBtn.textContent = "✔️";
        completeBtn.title = "Mark Complete";
        completeBtn.onclick = () => {
          task.completed = true;
          renderTasks();
        };

        const editBtn = document.createElement("button");
        editBtn.textContent = "✏️";
        editBtn.title = "Edit Task";
        editBtn.onclick = () => {
          const newName = prompt("Edit Task Name:", task.name);
          const newDate = prompt("Edit Due Date (YYYY-MM-DD):", task.date);
          if (newName && newDate) {
            task.name = newName;
            task.date = newDate;
            renderTasks();
          }
        };

        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "🗑️";
        deleteBtn.title = "Delete Task";
        deleteBtn.onclick = () => {
          if (confirm("Are you sure you want to delete this task?")) {
            tasks.splice(index, 1);
            renderTasks();
          }
        };

        actions.append(completeBtn, editBtn, deleteBtn);
        li.append(taskSpan, actions);
        taskList.appendChild(li);
      });
    }

   function downloadCSV() {
  const headers = ["Task", "Due Date", "Completed"];
  const rows = tasks.map(task => [task.name, task.date, task.completed ? "Yes" : "No"]);
  const csv = [headers, ...rows].map(r => r.join(",")).join("\n");
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);

  // Get current time in IST
  const nowIST = new Date().toLocaleString("en-IN", {
    timeZone: "Asia/Kolkata",
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
    hour12: false
  });

  // Format to file-safe name: DD-MM-YYYY_HH-MM-SS
  const formatted = nowIST.replace(/[/]/g, '-').replace(/, /g, '_').replace(/:/g, '-');

  const a = document.createElement("a");
  a.href = url;
  a.download = `tasks_${formatted}.csv`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}


  </script>
</body>
</html>
